"use strict";(()=>{var h=(n,a=!0)=>n.cloneNode(a);var L=(n=document)=>n.documentElement.getAttribute("data-wf-site");var p=class{async get(a,i,d=100){let s=`https://utils-api.vercel.app/api/counters${a}?sort_by=${i.sort_by}&order=${i.order}&limit=${d}`;try{let m=await fetch(s);return!m.ok&&m.status===404?E():await m.json()}catch{return E()}}async put(a){let i=`https://utils-api.vercel.app/api/counter/${a.name}`;try{return!!(await fetch(i,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok}catch{return!1}}};function E(){return[{count:0,name:"No counters found",last_updated:"",details:"",id:0,form:"",date_created:"",site_id:""}]}function g(n=""){let a={all:"",this:"/"+L()},i={sort_by:"name",order:"asc"},d=new p;n=a.hasOwnProperty(n)?a[n]:a.this;let s={name:"",newValue:0,oldValue:0,site_id:""},m=document.querySelector('[data-dash-element="confirm-text"]'),f;function v(r){let t=new Date(r);return isNaN(t.getTime())?"":t.toLocaleString("sv",{dateStyle:"short",timeStyle:"short"}).toString()}function S(r,t){let e=h(t),o=e.querySelector('[data-dash-element="counter-name"]'),l=e.querySelector('[data-dash-element="counter-updated"]'),c=e.querySelector('[data-dash-element="update-button"]'),u=e.querySelector('[data-dash-element="counter-count"]');if(r.name==="No counters found"){let y=e.querySelector('[data-dash-element="value-input"]');y&&y.remove(),c&&c.remove()}return o&&(o.textContent=r.name),l&&(l.textContent=v(r.last_updated)),u&&(u.textContent=r.count.toString()),c&&u&&c.addEventListener("click",()=>{T(e,r,u)}),e}function T(r,t,e){var c;let o=document.querySelector('[data-dash-element="modal-card"]'),l=r.querySelector('[data-dash-element="value-input"]');o&&l&&(!Number.isNaN(parseInt(l.value))&&o.classList.contains("cloak")?(s.name=t.name,s.site_id=t.site_id,s.newValue=parseInt(l.value),s.oldValue=parseInt(((c=e.textContent)==null?void 0:c.toString())||"0"),f=r,m&&(m.innerHTML=`Name: ${s.name}<br>Current value: ${s.oldValue}<br>New value: ${s.newValue}`),o.classList.remove("cloak")):(l.classList.add("error"),setTimeout(function(){l.classList.remove("error")},500)))}function b(){let r=document.querySelector('[data-dash-element="modal-card"]');if(!r)return;let t=document.querySelector('[data-dash-element="confirm-button"]');t==null||t.addEventListener("click",async()=>{if(x("loading"),r.classList.add("cloak"),await d.put({name:s.name,count:s.newValue,site_id:s.site_id})){if(f){let o=f.querySelector('[data-dash-element="counter-count"]');o&&(o.textContent=s.newValue.toString()),x("updated")}}else x("error")});let e=document.querySelectorAll('[data-dash-element="close-button"]');e.length>0&&e.forEach(o=>{o.addEventListener("click",()=>{r.classList.add("cloak")})})}function x(r){let t=document.querySelector('[data-dash-element="status-box"]');if(!t)return;let e=t.childNodes[0],o=t.childNodes[1];if(t.classList.remove("cloak"),r==="updated"){if(e&&e.classList.add("cloak"),!o)return;o.innerText="Updated",o.classList.remove("cloak")}else if(r==="loading")e&&e.classList.remove("cloak"),o.classList.add("cloak");else{if(e&&e.classList.add("cloak"),!o)return;o.innerText="Error",t.classList.add("error"),o.classList.remove("cloak")}setTimeout(function(){t.classList.add("cloak")},3e3)}function w(){let r=[{element:document.querySelector('[data-dash-element="name-label"]'),sort_by:"name",order:"asc"},{element:document.querySelector('[data-dash-element="last-increment-label"]'),sort_by:"last_updated",order:"asc"}],t=new URL(window.location.href);for(let e of r)if(e.element){let o=i.sort_by===e.sort_by&&i.order==="asc";t.searchParams.set("sort_by",e.sort_by),t.searchParams.set("order",o?"desc":"asc"),e.element.href=t.href}}(async function(){i.sort_by=new URLSearchParams(window.location.search).get("sort_by")||"name",i.order=new URLSearchParams(window.location.search).get("order")||"asc";let t=document.querySelector('[data-dash-element="counter-row"]'),e=await d.get(n,i,100);if(!e||!t)return;let o=t.parentElement;t.remove();let l=e.map(c=>S(c,t));o==null||o.append(...l),l.forEach(c=>{setTimeout(function(){c.classList.remove("cloak")},1e3)}),w(),b()})()}{let n=`.cloak { 
		opacity: 0;
		height: 0px;
		overflow: hidden;
		margin: auto;
	}`,a=document.createElement("style");a.textContent=n,document.head.appendChild(a)}document.addEventListener("DOMContentLoaded",()=>{let n=document.querySelector('[data-dash-counters="list"]'),a=(n==null?void 0:n.getAttribute("data-dash-counters-filter"))||void 0;n&&g(a)});})();
