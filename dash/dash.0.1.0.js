"use strict";(()=>{var u=(n,c=!0)=>n.cloneNode(c);var f=(n=document)=>n.documentElement.getAttribute("data-wf-site");function y(n=""){let c={all:"",this:"/"+f()},i={sort_by:"name",order:"asc"};n=c.hasOwnProperty(n)?c[n]:c.this;let a={name:"",newValue:0,oldValue:0,site_id:""};function p(){return[{count:0,name:"No counters found",last_updated:"",details:"",id:0,form:"",date_created:"",site_id:""}]}let x=document.querySelector('[data-dash-element="confirm-text"]'),d;async function E(){let o=`https://utils-api.vercel.app/api/counters${n}?sort_by=${i.sort_by}&order=${i.order}&limit=100`;try{let e=await fetch(o);return!e.ok&&e.status===404?p():await e.json()}catch{return p()}}function v(o){let e=new Date(o);return isNaN(e.getTime())?"":e.toLocaleString("sv",{dateStyle:"short",timeStyle:"short"}).toString()}function S(o,e){let t=u(e),r=t.querySelector('[data-dash-element="counter-name"]'),s=t.querySelector('[data-dash-element="counter-updated"]'),l=t.querySelector('[data-dash-element="update-button"]'),m=t.querySelector('[data-dash-element="counter-count"]');if(o.name==="No counters found"){let L=t.querySelector('[data-dash-element="value-input"]');L&&L.remove(),l&&l.remove()}return r&&(r.textContent=o.name),s&&(s.textContent=v(o.last_updated)),m&&(m.textContent=o.count.toString()),l&&m&&l.addEventListener("click",()=>{T(t,o,m)}),t}function T(o,e,t){var l;let r=document.querySelector('[data-dash-element="modal-card"]'),s=o.querySelector('[data-dash-element="value-input"]');r&&s&&(!Number.isNaN(parseInt(s.value))&&r.classList.contains("cloak")?(a.name=e.name,a.site_id=e.site_id,a.newValue=parseInt(s.value),a.oldValue=parseInt(((l=t.textContent)==null?void 0:l.toString())||"0"),d=o,x&&(x.innerHTML=`Name: ${a.name}<br>Current value: ${a.oldValue}<br>New value: ${a.newValue}`),r.classList.remove("cloak")):(s.classList.add("error"),setTimeout(function(){s.classList.remove("error")},500)))}function b(){let o=document.querySelector('[data-dash-element="modal-card"]');if(!o)return;let e=document.querySelector('[data-dash-element="confirm-button"]');e==null||e.addEventListener("click",async()=>{if(await g({name:a.name,count:a.newValue,site_id:a.site_id})){if(o.classList.add("cloak"),d){let r=d.querySelector('[data-dash-element="counter-count"]');r&&(r.textContent=a.newValue.toString()),h(!0)}}else h(!1),o.classList.add("cloak")});let t=document.querySelectorAll('[data-dash-element="close-button"]');t.length>0&&t.forEach(r=>{r.addEventListener("click",()=>{o.classList.add("cloak")})})}function h(o){let e=document.querySelector('[data-dash-element="status-box"]');if(!e)return;let t=e.childNodes[0];o?(t&&(t.innerText="Updated"),e.classList.remove("cloak")):(t&&(t.innerText="Error"),e.classList.add("error"),e.classList.remove("cloak")),setTimeout(function(){e.classList.add("cloak"),e.classList.remove("error")},3e3)}async function g(o){let e="https://utils-api.vercel.app/api/counter/"+o.name;try{return!!(await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok}catch{return!1}}function w(){let o=[{element:document.querySelector('[data-dash-element="name-label"]'),sort_by:"name",order:"asc"},{element:document.querySelector('[data-dash-element="last-increment-label"]'),sort_by:"last_updated",order:"asc"}],e=new URL(window.location.href);for(let t of o)if(t.element){let r=i.sort_by===t.sort_by&&i.order==="asc";e.searchParams.set("sort_by",t.sort_by),e.searchParams.set("order",r?"desc":"asc"),t.element.href=e.href}}(async function(){i.sort_by=new URLSearchParams(window.location.search).get("sort_by")||"name",i.order=new URLSearchParams(window.location.search).get("order")||"asc";let e=document.querySelector('[data-dash-element="counter-row"]'),t=await E();if(!t||!e)return;let r=e.parentElement;e.remove();let s=t.map(l=>S(l,e));r==null||r.append(...s),s.forEach(l=>{setTimeout(function(){l.classList.remove("cloak")},1e3)}),w(),b()})()}{let n=`.cloak { 
		opacity: 0;
		height: 0px;
		overflow: hidden;
		margin: auto;
	}`,c=document.createElement("style");c.textContent=n,document.head.appendChild(c)}document.addEventListener("DOMContentLoaded",()=>{let n=document.querySelector('[data-dash-counters="list"]'),c=(n==null?void 0:n.getAttribute("data-dash-counters-filter"))||void 0;n&&y(c)});})();
