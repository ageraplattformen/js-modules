"use strict";(()=>{var u=(n,i=!0)=>n.cloneNode(i);var d=(n=document)=>n.documentElement.getAttribute("data-wf-site");function h(n=""){let i={all:"",this:"/"+d()};n=i.hasOwnProperty(n)?i[n]:i.this;let a={name:"",newValue:0,oldValue:0,site_id:""};function p(){return[{count:0,name:"No counters found",last_updated:"",details:"",id:0,form:"",date_created:"",site_id:"",client_name:"",client_id:"",save_history:!1,last_person:{names:[]}}]}let f=document.querySelector('[data-dash-element="confirm-text"]'),m,v=`https://utils-api.vercel.app/api/counters${n}?sort_by=name&order=asc&limit=100`;async function E(){try{let e=await fetch(v);return!e.ok&&e.status===404?p():await e.json()}catch{return p()}}function T(e){let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleString("sv",{dateStyle:"short",timeStyle:"short"}).toString()}function y(e,t){let o=u(t),r=o.querySelector('[data-dash-element="counter-name"]'),s=o.querySelector('[data-dash-element="counter-updated"]'),l=o.querySelector('[data-dash-element="update-button"]'),c=o.querySelector('[data-dash-element="counter-count"]');if(e.name==="No counters found"){let L=o.querySelector('[data-dash-element="value-input"]');L&&L.remove(),l&&l.remove()}return r&&(r.textContent=e.name),s&&(s.textContent=T(e.last_updated)),c&&(c.textContent=e.count.toString()),l&&c&&l.addEventListener("click",()=>{S(o,e,c)}),o}function S(e,t,o){var l;let r=document.querySelector('[data-dash-element="modal-card"]'),s=e.querySelector('[data-dash-element="value-input"]');r&&s&&(!Number.isNaN(parseInt(s.value))&&r.classList.contains("cloak")?(a.name=t.name,a.site_id=t.site_id,a.newValue=parseInt(s.value),a.oldValue=parseInt(((l=o.textContent)==null?void 0:l.toString())||"0"),m=e,f&&(f.innerHTML=`Name: ${a.name}<br>Current value: ${a.oldValue}<br>New value: ${a.newValue}`),r.classList.remove("cloak")):(s.classList.add("error"),setTimeout(function(){s.classList.remove("error")},500)))}function g(){let e=document.querySelector('[data-dash-element="modal-card"]');if(!e)return;let t=document.querySelector('[data-dash-element="confirm-button"]');t==null||t.addEventListener("click",async()=>{if(await C({name:a.name,count:a.newValue,site_id:a.site_id})){if(e.classList.add("cloak"),m){let r=m.querySelector('[data-dash-element="counter-count"]');r&&(r.textContent=a.newValue.toString()),x(!0)}}else x(!1),e.classList.add("cloak")});let o=document.querySelectorAll('[data-dash-element="close-button"]');o.length>0&&o.forEach(r=>{r.addEventListener("click",()=>{e.classList.add("cloak")})})}function x(e){let t=document.querySelector('[data-dash-element="status-box"]');if(!t)return;let o=t.childNodes[0];e?(o&&(o.innerText="Updated"),t.classList.remove("cloak")):(o&&(o.innerText="Error"),t.classList.add("error"),t.classList.remove("cloak")),setTimeout(function(){t.classList.add("cloak"),t.classList.remove("error")},1e3)}async function C(e){let t="https://utils-api.vercel.app/api/counter/"+e.name;try{return!!(await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok}catch{return!1}}(async function(){let t=document.querySelector('[data-dash-element="counter-row"]'),o=await E();if(!o||!t)return;let r=t.parentElement;t.remove();let s=o.map(l=>y(l,t));r==null||r.append(...s),s.forEach(l=>{setTimeout(function(){l.classList.remove("cloak")},1e3)}),g()})()}{let n=`.cloak { 
		opacity: 0;
		height: 0px;
		overflow: hidden;
		margin: auto;
	}`,i=document.createElement("style");i.textContent=n,document.head.appendChild(i)}document.addEventListener("DOMContentLoaded",()=>{let n=document.querySelector('[data-dash-counters="list"]'),i=(n==null?void 0:n.getAttribute("data-dash-counters-filter"))||void 0;n&&h(i)});})();
