"use strict";(()=>{function d(r){r.classList.contains("cloak")||r.classList.add("cloak")}function u(r){r.classList.contains("cloak")&&r.classList.remove("cloak")}function w(){{let r=`.cloak { 
			opacity: 0;
			height: 0px;
      overflow: hidden;
			margin: auto;
		}`,a=document.createElement("style");a.textContent=r,document.head.appendChild(a)}}var y=(r,a=!0)=>r.cloneNode(a);var E=(r=document)=>r.documentElement.getAttribute("data-wf-site");var x=class{async get(a,c,f=100){let s=`https://utils-api.vercel.app/api/counters${a}?sort_by=${c.sort_by}&order=${c.order}&limit=${f}`;try{let m=await fetch(s);return!m.ok&&m.status===404?T():await m.json()}catch{return T()}}async put(a){let c=`https://utils-api.vercel.app/api/counter/${a.name}`;try{return!!(await fetch(c,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok}catch{return!1}}};function T(){return[{count:0,name:"No counters found",last_updated:"",details:"",id:0,form:"",date_created:"",site_id:""}]}function b(){var S;let r=((S=document.querySelector('[data-dash-counters="list"]'))==null?void 0:S.getAttribute("data-dash-counters-filter"))||"",a={all:"",this:"/"+E()};a.hasOwnProperty(r)?r=a[r]:r!==""?r=`/${r}`:r=a.this;let c={sort_by:"name",order:"asc"},f=new x,s={name:"",newValue:0,oldValue:0,site_id:""},m=document.querySelector('[data-dash-element="loading-row"]');m&&u(m);let g=document.querySelector('[data-dash-element="confirm-text"]'),h;function C(n){let t=new Date(n);return isNaN(t.getTime())?"":t.toLocaleString("sv",{dateStyle:"short",timeStyle:"short"}).toString()}function H(n,t){let e=y(t),o=e.querySelector('[data-dash-element="counter-name"]'),l=e.querySelector('[data-dash-element="counter-updated"]'),i=e.querySelector('[data-dash-element="update-button"]'),p=e.querySelector('[data-dash-element="counter-count"]');if(n.name==="No counters found"){let v=e.querySelector('[data-dash-element="value-input"]');v&&v.remove(),i&&i.remove()}return o&&(o.textContent=n.name),l&&(l.textContent=C(n.last_updated)),p&&(p.textContent=n.count.toString()),i&&p&&i.addEventListener("click",()=>{M(e,n,p)}),e}function M(n,t,e){var i;let o=document.querySelector('[data-dash-element="modal-card"]'),l=n.querySelector('[data-dash-element="value-input"]');o&&l&&(!Number.isNaN(parseInt(l.value))&&o.classList.contains("cloak")?(s.name=t.name,s.site_id=t.site_id,s.newValue=parseInt(l.value),s.oldValue=parseInt(((i=e.textContent)==null?void 0:i.toString())||"0"),h=n,g&&(g.innerHTML=`Name: ${s.name}<br>Current value: ${s.oldValue}<br>New value: ${s.newValue}`),u(o)):(l.classList.add("error"),setTimeout(function(){l.classList.remove("error")},500)))}function D(){let n=document.querySelector('[data-dash-element="modal-card"]');if(!n)return;let t=document.querySelector('[data-dash-element="confirm-button"]');t==null||t.addEventListener("click",async()=>{if(L("loading"),d(n),await f.put({name:s.name,count:s.newValue,site_id:s.site_id})){if(h){let o=h.querySelector('[data-dash-element="counter-count"]');o&&(o.textContent=s.newValue.toString()),L("updated")}}else L("error")});let e=document.querySelectorAll('[data-dash-element="close-button"]');e.length>0&&e.forEach(o=>{o.addEventListener("click",()=>{d(n)})})}function L(n){let t=document.querySelector('[data-dash-element="status-box"]');if(!t)return;let e=t.childNodes[0],o=t.childNodes[1];if(u(t),n==="updated"){if(e&&d(e),!o)return;o.innerText="Updated",u(o)}else if(n==="loading")e&&u(e),d(o);else{if(e&&d(e),!o)return;o.innerText="Error",t.classList.add("error"),u(o)}setTimeout(function(){d(t)},3e3)}function _(){let n=[{element:document.querySelector('[data-dash-element="name-label"]'),sort_by:"name",order:"asc"},{element:document.querySelector('[data-dash-element="last-increment-label"]'),sort_by:"last_updated",order:"asc"}],t=new URL(window.location.href);for(let e of n)if(e.element){let o=c.sort_by===e.sort_by&&c.order==="asc";t.searchParams.set("sort_by",e.sort_by),t.searchParams.set("order",o?"desc":"asc"),e.element.href=t.href}}(async function(){c.sort_by=new URLSearchParams(window.location.search).get("sort_by")||"name",c.order=new URLSearchParams(window.location.search).get("order")||"asc";let t=document.querySelector('[data-dash-element="counter-row"]'),e=await f.get(r,c,100);if(!e||(m&&e&&d(m),!t))return;let o=t.parentElement;t.remove();let l=e.map(i=>H(i,t));o==null||o.append(...l),l.forEach((i,p)=>{setTimeout(function(){u(i)},10*p)}),_(),D()})()}function k(){w(),document.addEventListener("DOMContentLoaded",()=>{b()})}window.ageraDash||(window.ageraDash=!0,k());})();
